# ملفات SQL لنظام إشعارات Firebase

## 📁 الملفات المتاحة

### 1. `firebase_notifications_database.sql` - الإعداد الكامل
**الوصف**: ملف SQL شامل يحتوي على جميع الجداول والإعدادات والبيانات التجريبية
**المحتويات**:
- إنشاء جدول `notifications`
- إضافة عمود `fcm_token` لجدول `cleaners`
- إنشاء الفهارس المطلوبة
- بيانات تجريبية شاملة
- استعلامات المراقبة
- تعليقات مفصلة

**الاستخدام**: للاستيراد الكامل على خادم جديد

### 2. `firebase_notifications_quick_setup.sql` - الإعداد السريع
**الوصف**: ملف SQL مبسط للإعداد السريع
**المحتويات**:
- إضافة عمود `fcm_token`
- إنشاء جدول `notifications`
- إنشاء الفهارس الأساسية
- بيانات تجريبية أساسية
- استعلامات المراقبة الأساسية

**الاستخدام**: للإعداد السريع على خادم موجود

### 3. `firebase_notifications_test_data.sql` - البيانات التجريبية فقط
**الوصف**: ملف SQL يحتوي على البيانات التجريبية فقط
**المحتويات**:
- 5 عمال نظافة تجريبيين مع FCM tokens
- 5 شاليهات تجريبية
- 8 إشعارات تجريبية متنوعة
- استعلامات للاختبار

**الاستخدام**: لإضافة بيانات تجريبية لاختبار النظام

### 4. `firebase_notifications_clean_data.sql` - تنظيف البيانات
**الوصف**: ملف SQL لحذف البيانات التجريبية
**المحتويات**:
- حذف الإشعارات التجريبية
- حذف عمال النظافة التجريبيين
- حذف الشاليهات التجريبية
- إعادة تعيين AUTO_INCREMENT

**الاستخدام**: لتنظيف البيانات التجريبية بعد الاختبار

## 🚀 كيفية الاستخدام

### للخادم الجديد:
```bash
# 1. استيراد الإعداد الكامل
mysql -u username -p database_name < firebase_notifications_database.sql

# 2. أو استيراد الإعداد السريع
mysql -u username -p database_name < firebase_notifications_quick_setup.sql
```

### للخادم الموجود:
```bash
# 1. إضافة البيانات التجريبية
mysql -u username -p database_name < firebase_notifications_test_data.sql

# 2. بعد الاختبار، تنظيف البيانات
mysql -u username -p database_name < firebase_notifications_clean_data.sql
```

### باستخدام phpMyAdmin:
1. افتح phpMyAdmin
2. اختر قاعدة البيانات
3. انقر على "Import"
4. اختر ملف SQL المطلوب
5. انقر على "Go"

## 📊 البيانات التجريبية

### عمال النظافة:
| ID | الاسم | الهاتف | البريد الإلكتروني | FCM Token |
|----|-------|--------|-------------------|-----------|
| 1 | أحمد محمد | 01234567890 | ahmed@example.com | fcm_token_ahmed_123 |
| 2 | محمد علي | 01234567891 | mohamed@example.com | fcm_token_mohamed_456 |
| 3 | سعد حسن | 01234567892 | saad@example.com | fcm_token_saad_789 |
| 4 | خالد أحمد | 01234567893 | khaled@example.com | fcm_token_khaled_101 |
| 5 | علي محمود | 01234567894 | ali@example.com | fcm_token_ali_202 |

### الشاليهات:
| ID | الاسم | الكود | الموقع |
|----|-------|--------|--------|
| 1 | شاليه الشاطئ الذهبي | CH001 | شاطئ البحر الأحمر - الغردقة |
| 2 | شاليه الفردوس | CH002 | شاطئ البحر الأحمر - الغردقة |
| 3 | شاليه النجوم | CH003 | شاطئ البحر الأحمر - الغردقة |
| 4 | شاليه القمر | CH004 | شاطئ البحر الأحمر - الغردقة |
| 5 | شاليه الشمس | CH005 | شاطئ البحر الأحمر - الغردقة |

### الإشعارات:
- تنظيف منتظم (قبل)
- بلاغ ضرر
- تقرير صيانة (بعد)
- تقرير مكافحة (قبل)
- تنظيف عميق (بعد)
- إشعارات تجريبية

## 🔧 استعلامات المراقبة

### إحصائيات الإشعارات:
```sql
SELECT 
    'إجمالي الإشعارات' as metric,
    COUNT(*) as count
FROM notifications
UNION ALL
SELECT 
    'الإشعارات المرسلة' as metric,
    COUNT(*) as count
FROM notifications 
WHERE sent_at IS NOT NULL;
```

### إحصائيات عمال النظافة:
```sql
SELECT 
    'إجمالي عمال النظافة النشطين' as metric,
    COUNT(*) as count
FROM cleaners 
WHERE status = 'active'
UNION ALL
SELECT 
    'عمال النظافة الذين لديهم FCM Token' as metric,
    COUNT(*) as count
FROM cleaners 
WHERE status = 'active' AND fcm_token IS NOT NULL;
```

## ⚠️ تحذيرات مهمة

1. **احتياطي**: قم بعمل نسخة احتياطية من قاعدة البيانات قبل الاستيراد
2. **البيانات الموجودة**: تأكد من عدم وجود تضارب في البيانات
3. **الصلاحيات**: تأكد من وجود صلاحيات كافية لإنشاء الجداول والفهارس
4. **البيانات التجريبية**: احذف البيانات التجريبية بعد الاختبار

## 🧪 اختبار النظام

بعد استيراد البيانات، يمكنك اختبار النظام باستخدام:

### 1. اختبار إرسال إشعار:
```http
POST /api/test/notification
{
    "title": "إشعار تجريبي",
    "body": "هذا إشعار تجريبي لاختبار النظام",
    "cleaner_id": 1
}
```

### 2. فحص إعدادات Firebase:
```http
GET /api/test/firebase-config
```

### 3. تحديث FCM Token:
```http
POST /api/fcm-token
{
    "fcm_token": "your_actual_fcm_token"
}
```

## 📝 ملاحظات

- جميع كلمات المرور التجريبية هي: `password`
- FCM Tokens التجريبية هي مجرد أمثلة
- يمكن تعديل البيانات التجريبية حسب الحاجة
- تأكد من إعداد Firebase بشكل صحيح قبل الاختبار

## 🆘 الدعم

إذا واجهت أي مشاكل:
1. تحقق من سجلات MySQL
2. تأكد من صلاحيات المستخدم
3. تحقق من وجود الجداول المطلوبة
4. راجع ملف `FIREBASE_NOTIFICATIONS_GUIDE.md` للتفاصيل الكاملة
